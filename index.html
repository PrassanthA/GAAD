<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VR Color Ball Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <style>
    body { margin: 0; font-family: sans-serif; }
    .scoreboard, .buttons {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.8);
      padding: 10px;
      border-radius: 5px;
      z-index: 1;
    }
    .buttons { top: auto; bottom: 10px; }
    button { margin: 5px; }
  </style>
</head>
<body>
  <div class="scoreboard">
    <div id="correct">Correct: <span>0</span></div>
    <div id="incorrect">Incorrect: <span>0</span></div>
  </div>
  <div class="buttons">
    <button id="shuffleBtn">Shuffle</button>
    <button id="greyscaleBtn">Greyscale</button>
  </div>

  <a-scene background="color: #e0e7ff">
    <!-- Camera -->
    <a-entity id="cameraRig" position="0 1.6 0">
      <a-camera></a-camera>
    </a-entity>

    <!-- Lighting -->
    <a-light type="ambient" color="#ffffff" intensity="0.5"></a-light>
    <a-light type="directional" position="-1 2 1" intensity="0.8"></a-light>

    <!-- Sky -->
    <a-sky color="#cddafd"></a-sky>

    <!-- Title -->
    <a-entity text="value: Color Ball Game; align: center; width: 6" position="0 3 -4"></a-entity>

    <!-- Drop Targets -->
    <a-box class="drop-target" data-color="red" color="red" position="-2 1 -3" width="1" height="1" depth="0.2"></a-box>
    <a-box class="drop-target" data-color="blue" color="blue" position="-1 1 -3" width="1" height="1" depth="0.2"></a-box>
    <a-box class="drop-target" data-color="green" color="green" position="0 1 -3" width="1" height="1" depth="0.2"></a-box>
    <a-box class="drop-target" data-color="yellow" color="yellow" position="1 1 -3" width="1" height="1" depth="0.2"></a-box>
    <a-box class="drop-target" data-color="purple" color="purple" position="2 1 -3" width="1" height="1" depth="0.2"></a-box>
  </a-scene>

  <script>
    const scene = document.querySelector('a-scene');
    const colors = ['red', 'blue', 'green', 'yellow', 'purple'];
    const balls = [];
    const ballCount = 25;
    const radius = 4;
    const verticalHeight = 1.4;
    let greyscaleOn = false;
    let correct = 0;
    let incorrect = 0;

    function createBalls() {
      balls.forEach(ball => ball.remove());
      balls.length = 0;

      for (let i = 0; i < ballCount; i++) {
        const angle = (i / (ballCount - 1)) * Math.PI;
        const x = radius * Math.cos(angle - Math.PI / 2);
        const z = -radius * Math.sin(angle - Math.PI / 2);
        const color = colors[i % colors.length];

        const ball = document.createElement('a-sphere');
        ball.setAttribute('position', `${x} ${verticalHeight} ${z}`);
        ball.setAttribute('radius', '0.25');
        ball.setAttribute('color', greyscaleOn ? 'gray' : color);
        ball.setAttribute('class', 'ball');
        ball.dataset.originalColor = color;

        ball.setAttribute('animation__hover', `
          property: scale;
          dir: alternate;
          dur: 1000;
          loop: true;
          to: 1.2 1.2 1.2
        `);

        ball.addEventListener('click', () => {
          moveBall(ball);
        });

        balls.push(ball);
        scene.appendChild(ball);
      }
    }

    function moveBall(ball) {
      const fromPos = ball.getAttribute('position');
      const toZ = -3;
      const toY = 1.2;

      // Drop to nearest target
      const closest = document.querySelectorAll('.drop-target');
      let closestTarget = null;
      let minDistance = Infinity;

      closest.forEach(target => {
        const pos = target.getAttribute('position');
        const dx = pos.x - fromPos.x;
        const dz = pos.z - fromPos.z;
        const dist = Math.sqrt(dx*dx + dz*dz);
        if (dist < minDistance) {
          minDistance = dist;
          closestTarget = target;
        }
      });

      if (closestTarget && minDistance < 1.5) {
        ball.setAttribute('position', {
          x: closestTarget.getAttribute('position').x,
          y: toY,
          z: toZ
        });

        const expected = closestTarget.getAttribute('data-color');
        const actual = ball.dataset.originalColor;

        if (expected === actual) {
          correct++;
        } else {
          incorrect++;
        }
        document.querySelector('#correct span').textContent = correct;
        document.querySelector('#incorrect span').textContent = incorrect;
      }
    }

    document.getElementById('shuffleBtn').addEventListener('click', () => {
      createBalls();
    });

    document.getElementById('greyscaleBtn').addEventListener('click', () => {
      greyscaleOn = !greyscaleOn;
      balls.forEach(ball => {
        ball.setAttribute('color', greyscaleOn ? 'gray' : ball.dataset.originalColor);
      });
    });

    createBalls();
  </script>
</body>
</html>
