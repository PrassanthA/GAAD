<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Color Quest AR (A-Frame)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- A-Frame and Super Hands for grabbing -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-super-hands-component@4.0.5/dist/aframe-super-hands.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #popup {
        position: absolute;
        top: 30px; left: 0; right: 0;
        text-align: center;
        font-size: 2em;
        color: #fff;
        background: rgba(0,0,0,0.7);
        z-index: 10;
        display: none;
        padding: 0.5em 0;
      }
    </style>
  </head>
  <body>
    <div id="popup"></div>
    <a-scene
      vr-mode-ui="enabled: false"
      renderer="colorManagement: true;"
      cursor="rayOrigin: mouse"
      embedded
      xrweb="allowedDevices: any"
    >
      <!-- Lighting -->
      <a-entity light="type: ambient; intensity: 0.7"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="1 2 1"></a-entity>

      <!-- Camera, hands, and raycaster for grabbing -->
      <a-entity id="cameraRig">
        <a-entity camera look-controls position="0 1.6 0"></a-entity>
        <a-entity laser-controls="hand: right"></a-entity>
        <a-entity laser-controls="hand: left"></a-entity>
        <a-entity hand-controls="hand: right" super-hands></a-entity>
        <a-entity hand-controls="hand: left" super-hands></a-entity>
      </a-entity>

      <!-- Color Balls (draggable spheres) -->
      <a-sphere id="ball-red" class="color-ball" color="red" radius="0.08" position="-0.4 1.2 -1" grabbable droppable dynamic-body></a-sphere>
      <a-sphere id="ball-blue" class="color-ball" color="blue" radius="0.08" position="0 1.2 -1" grabbable droppable dynamic-body></a-sphere>
      <a-sphere id="ball-green" class="color-ball" color="green" radius="0.08" position="0.4 1.2 -1" grabbable droppable dynamic-body></a-sphere>

      <!-- Color Boxes (targets) -->
      <a-box id="target-red" class="color-target" color="red" width="0.15" height="0.15" depth="0.15" position="-0.4 1 -1" static-body droppable></a-box>
      <a-box id="target-blue" class="color-target" color="blue" width="0.15" height="0.15" depth="0.15" position="0 1 -1" static-body droppable></a-box>
      <a-box id="target-green" class="color-target" color="green" width="0.15" height="0.15" depth="0.15" position="0.4 1 -1" static-body droppable></a-box>
    </a-scene>
    <script>
      // Helper: show popup
      function showPopup(msg, color) {
        const popup = document.getElementById('popup');
        popup.textContent = msg;
        popup.style.background = color === 'green' ? 'rgba(0,128,0,0.85)' : 'rgba(128,0,0,0.85)';
        popup.style.display = 'block';
        setTimeout(() => { popup.style.display = 'none'; }, 1200);
      }

      // Listen for drop events on targets
      document.addEventListener('DOMContentLoaded', () => {
        const targets = document.querySelectorAll('.color-target');
        targets.forEach(target => {
          target.addEventListener('drag-drop', function (evt) {
            const ball = evt.detail.dropped;
            // Check color match
            if (ball.getAttribute('color') === target.getAttribute('color')) {
              showPopup('Correct!', 'green');
              ball.parentNode.removeChild(ball); // Remove ball from scene
            } else {
              showPopup('Incorrect!', 'red');
              // Optionally, move ball back to original position
            }
          });
        });
      });
    </script>
  </body>
</html>